import{b as y,g as T,k as De,c as q,d as Ye}from"./@babel-DAuA_VVL.js";import{n as ye,t as Ee,g as h,c as Ie,v as Je,d as te}from"./@rc-component-BqtN6ESW.js";import{c as oe}from"./classnames-D0qp76y0.js";import{B as ze,t as Ge}from"./rc-input-CbIIXZWl.js";import{r}from"./react-DEe3I7kj.js";import{b as Qe,x as j,J as Xe,L as Ze,M as ue,i as ea}from"./rc-util-BCTlEnPv.js";function aa(e,i){var u=r.useRef(null);function x(){try{var c=e.selectionStart,m=e.selectionEnd,f=e.value,d=f.substring(0,c),v=f.substring(m);u.current={start:c,end:m,value:f,beforeTxt:d,afterTxt:v}}catch{}}function E(){if(e&&u.current&&i)try{var c=e.value,m=u.current,f=m.beforeTxt,d=m.afterTxt,v=m.start,l=c.length;if(c.startsWith(f))l=f.length;else if(c.endsWith(d))l=c.length-u.current.afterTxt.length;else{var N=f[v-1],p=c.indexOf(N,v-1);p!==-1&&(l=p+1)}e.setSelectionRange(l,l)}catch(g){Qe(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(g.message))}}return[x,E]}var na=200,ra=600;function ta(e){var i=e.prefixCls,u=e.upNode,x=e.downNode,E=e.upDisabled,c=e.downDisabled,m=e.onStep,f=r.useRef(),d=r.useRef([]),v=r.useRef();v.current=m;var l=function(){clearTimeout(f.current)},N=function(I,A){I.preventDefault(),l(),v.current(A);function D(){v.current(A),f.current=setTimeout(D,na)}f.current=setTimeout(D,ra)};r.useEffect(function(){return function(){l(),d.current.forEach(function(S){return j.cancel(S)})}},[]);var p=Xe();if(p)return null;var g="".concat(i,"-handler"),V=oe(g,"".concat(g,"-up"),y({},"".concat(g,"-up-disabled"),E)),M=oe(g,"".concat(g,"-down"),y({},"".concat(g,"-down-disabled"),c)),b=function(){return d.current.push(j(l))},C={unselectable:"on",role:"button",onMouseUp:b,onMouseLeave:b};return r.createElement("div",{className:"".concat(g,"-wrap")},r.createElement("span",T({},C,{onMouseDown:function(I){N(I,!0)},"aria-label":"Increase Value","aria-disabled":E,className:V}),u||r.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-up-inner")})),r.createElement("span",T({},C,{onMouseDown:function(I){N(I,!1)},"aria-label":"Decrease Value","aria-disabled":c,className:M}),x||r.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-down-inner")})))}function we(e){var i=typeof e=="number"?ye(e):Ee(e).fullStr,u=i.includes(".");return u?Ee(i.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}const ua=function(){var e=r.useRef(0),i=function(){j.cancel(e.current)};return r.useEffect(function(){return i},[]),function(u){i(),e.current=j(function(){u()})}};var oa=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","changeOnWheel","controls","classNames","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep","changeOnBlur","domRef"],la=["disabled","style","prefixCls","value","prefix","suffix","addonBefore","addonAfter","className","classNames"],xe=function(i,u){return i||u.isEmpty()?u.toString():u.toNumber()},Ce=function(i){var u=h(i);return u.isInvalidate()?null:u},sa=r.forwardRef(function(e,i){var u=e.prefixCls,x=e.className,E=e.style,c=e.min,m=e.max,f=e.step,d=f===void 0?1:f,v=e.defaultValue,l=e.value,N=e.disabled,p=e.readOnly,g=e.upHandler,V=e.downHandler,M=e.keyboard,b=e.changeOnWheel,C=b===void 0?!1:b,S=e.controls,I=S===void 0?!0:S;e.classNames;var A=e.stringMode,D=e.parser,O=e.formatter,_=e.precision,B=e.decimalSeparator,Y=e.onChange,J=e.onInput,z=e.onPressEnter,G=e.onStep,le=e.changeOnBlur,Ve=le===void 0?!0:le,Me=e.domRef,Oe=De(e,oa),se="".concat(u,"-input"),k=r.useRef(null),_e=r.useState(!1),ie=q(_e,2),Q=ie[0],ce=ie[1],w=r.useRef(!1),F=r.useRef(!1),K=r.useRef(!1),Be=r.useState(function(){return h(l??v)}),fe=q(Be,2),s=fe[0],de=fe[1];function Ue(n){l===void 0&&de(n)}var X=r.useCallback(function(n,a){if(!a)return _>=0?_:Math.max(Ie(n),Ie(d))},[_,d]),Z=r.useCallback(function(n){var a=String(n);if(D)return D(a);var o=a;return B&&(o=o.replace(B,".")),o.replace(/[^\w.-]+/g,"")},[D,B]),ee=r.useRef(""),ve=r.useCallback(function(n,a){if(O)return O(n,{userTyping:a,input:String(ee.current)});var o=typeof n=="number"?ye(n):n;if(!a){var t=X(o,a);if(Je(o)&&(B||t>=0)){var R=B||".";o=te(o,R,t)}}return o},[O,X,B]),$e=r.useState(function(){var n=v??l;return s.isInvalidate()&&["string","number"].includes(Ye(n))?Number.isNaN(n)?"":n:ve(s.toString(),!1)}),me=q($e,2),H=me[0],pe=me[1];ee.current=H;function P(n,a){pe(ve(n.isInvalidate()?n.toString(!1):n.toString(!a),a))}var U=r.useMemo(function(){return Ce(m)},[m,_]),$=r.useMemo(function(){return Ce(c)},[c,_]),ge=r.useMemo(function(){return!U||!s||s.isInvalidate()?!1:U.lessEquals(s)},[U,s]),Ne=r.useMemo(function(){return!$||!s||s.isInvalidate()?!1:s.lessEquals($)},[$,s]),Ae=aa(k.current,Q),be=q(Ae,2),ke=be[0],Fe=be[1],Se=function(a){return U&&!a.lessEquals(U)?U:$&&!$.lessEquals(a)?$:null},ae=function(a){return!Se(a)},L=function(a,o){var t=a,R=ae(t)||t.isEmpty();if(!t.isEmpty()&&!o&&(t=Se(t)||t,R=!0),!p&&!N&&R){var W=t.toString(),re=X(W,o);return re>=0&&(t=h(te(W,".",re)),ae(t)||(t=h(te(W,".",re,!0)))),t.equals(s)||(Ue(t),Y==null||Y(t.isEmpty()?null:xe(A,t)),l===void 0&&P(t,o)),t}return s},He=ua(),Re=function n(a){if(ke(),ee.current=a,pe(a),!F.current){var o=Z(a),t=h(o);t.isNaN()||L(t,!0)}J==null||J(a),He(function(){var R=a;D||(R=a.replace(/ã€‚/g,".")),R!==a&&n(R)})},Pe=function(){F.current=!0},We=function(){F.current=!1,Re(k.current.value)},Ke=function(a){Re(a.target.value)},ne=function(a){var o;if(!(a&&ge||!a&&Ne)){w.current=!1;var t=h(K.current?we(d):d);a||(t=t.negate());var R=(s||h(0)).add(t.toString()),W=L(R,!1);G==null||G(xe(A,W),{offset:K.current?we(d):d,type:a?"up":"down"}),(o=k.current)===null||o===void 0||o.focus()}},he=function(a){var o=h(Z(H)),t;o.isNaN()?t=L(s,a):t=L(o,a),l!==void 0?P(s,!1):t.isNaN()||P(t,!1)},Le=function(){w.current=!0},qe=function(a){var o=a.key,t=a.shiftKey;w.current=!0,K.current=t,o==="Enter"&&(F.current||(w.current=!1),he(!1),z==null||z(a)),M!==!1&&!F.current&&["Up","ArrowUp","Down","ArrowDown"].includes(o)&&(ne(o==="Up"||o==="ArrowUp"),a.preventDefault())},Te=function(){w.current=!1,K.current=!1};r.useEffect(function(){if(C&&Q){var n=function(t){ne(t.deltaY<0),t.preventDefault()},a=k.current;if(a)return a.addEventListener("wheel",n,{passive:!1}),function(){return a.removeEventListener("wheel",n)}}});var je=function(){Ve&&he(!1),ce(!1),w.current=!1};return ue(function(){s.isInvalidate()||P(s,!1)},[_,O]),ue(function(){var n=h(l);de(n);var a=h(Z(H));(!n.equals(a)||!w.current||O)&&P(n,w.current)},[l]),ue(function(){O&&Fe()},[H]),r.createElement("div",{ref:Me,className:oe(u,x,y(y(y(y(y({},"".concat(u,"-focused"),Q),"".concat(u,"-disabled"),N),"".concat(u,"-readonly"),p),"".concat(u,"-not-a-number"),s.isNaN()),"".concat(u,"-out-of-range"),!s.isInvalidate()&&!ae(s))),style:E,onFocus:function(){ce(!0)},onBlur:je,onKeyDown:qe,onKeyUp:Te,onCompositionStart:Pe,onCompositionEnd:We,onBeforeInput:Le},I&&r.createElement(ta,{prefixCls:u,upNode:g,downNode:V,upDisabled:ge,downDisabled:Ne,onStep:ne}),r.createElement("div",{className:"".concat(se,"-wrap")},r.createElement("input",T({autoComplete:"off",role:"spinbutton","aria-valuemin":c,"aria-valuemax":m,"aria-valuenow":s.isInvalidate()?null:s.toString(),step:d},Oe,{ref:ea(k,i),className:se,value:H,onChange:Ke,disabled:N,readOnly:p}))))}),pa=r.forwardRef(function(e,i){var u=e.disabled,x=e.style,E=e.prefixCls,c=E===void 0?"rc-input-number":E,m=e.value,f=e.prefix,d=e.suffix,v=e.addonBefore,l=e.addonAfter,N=e.className,p=e.classNames,g=De(e,la),V=r.useRef(null),M=r.useRef(null),b=r.useRef(null),C=function(I){b.current&&Ge(b.current,I)};return r.useImperativeHandle(i,function(){return Ze(b.current,{focus:C,nativeElement:V.current.nativeElement||M.current})}),r.createElement(ze,{className:N,triggerFocus:C,prefixCls:c,value:m,disabled:u,style:x,prefix:f,suffix:d,addonAfter:l,addonBefore:v,classNames:p,components:{affixWrapper:"div",groupWrapper:"div",wrapper:"div",groupAddon:"div"},ref:V},r.createElement(sa,T({prefixCls:c,disabled:u,ref:b,domRef:M,className:p==null?void 0:p.input},g)))});export{pa as I};
