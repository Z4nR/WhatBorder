import{t as q,g as J}from"./@babel-DAuA_VVL.js";import{r as n,j as Y}from"./react-DEe3I7kj.js";import{c as Q,d as X,s as Z,h as $,f as ee,a as te,l as ae,b as ie,e as se,g as re,i as ne,j as le,k as ce,m as he,E as A,n as fe,o as oe,p as ue,q as de,r as me,t as ge,u as pe,v as Se,w as be,x as ve,y as P,z as ye,A as x,B as xe,C as Ee,D as ke,F as Ce,S as Te}from"./@codemirror-DFlIbH2h.js";var F=function(e){e===void 0&&(e={});var{crosshairCursor:l=!1}=e,a=[];e.closeBracketsKeymap!==!1&&(a=a.concat(Q)),e.defaultKeymap!==!1&&(a=a.concat(X)),e.searchKeymap!==!1&&(a=a.concat(Z)),e.historyKeymap!==!1&&(a=a.concat($)),e.foldKeymap!==!1&&(a=a.concat(ee)),e.completionKeymap!==!1&&(a=a.concat(te)),e.lintKeymap!==!1&&(a=a.concat(ae));var i=[];return e.lineNumbers!==!1&&i.push(ie()),e.highlightActiveLineGutter!==!1&&i.push(se()),e.highlightSpecialChars!==!1&&i.push(re()),e.history!==!1&&i.push(ne()),e.foldGutter!==!1&&i.push(le()),e.drawSelection!==!1&&i.push(ce()),e.dropCursor!==!1&&i.push(he()),e.allowMultipleSelections!==!1&&i.push(A.allowMultipleSelections.of(!0)),e.indentOnInput!==!1&&i.push(fe()),e.syntaxHighlighting!==!1&&i.push(oe(ye,{fallback:!0})),e.bracketMatching!==!1&&i.push(ue()),e.closeBrackets!==!1&&i.push(de()),e.autocompletion!==!1&&i.push(me()),e.rectangularSelection!==!1&&i.push(ge()),l!==!1&&i.push(pe()),e.highlightActiveLine!==!1&&i.push(Se()),e.highlightSelectionMatches!==!1&&i.push(be()),e.tabSize&&typeof e.tabSize=="number"&&i.push(ve.of(" ".repeat(e.tabSize))),i.concat([P.of(a.flat())]).filter(Boolean)},Le=x.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),Me=function(e){e===void 0&&(e={});var{indentWithTab:l=!0,editable:a=!0,readOnly:i=!1,theme:d="light",placeholder:f="",basicSetup:o=!0}=e,r=[];switch(l&&r.unshift(P.of([xe])),o&&(typeof o=="boolean"?r.unshift(F()):r.unshift(F(o))),f&&r.unshift(Ee(f)),d){case"light":r.push(Le);break;case"dark":r.push(ke);break;case"none":break;default:r.push(d);break}return a===!1&&r.push(x.editable.of(!1)),i&&r.push(A.readOnly.of(!0)),[...r]},We=t=>({line:t.state.doc.lineAt(t.state.selection.main.from),lineCount:t.state.doc.lines,lineBreak:t.state.lineBreak,length:t.state.doc.length,readOnly:t.state.readOnly,tabSize:t.state.tabSize,selection:t.state.selection,selectionAsSingle:t.state.selection.asSingle().main,ranges:t.state.selection.ranges,selectionCode:t.state.sliceDoc(t.state.selection.main.from,t.state.selection.main.to),selections:t.state.selection.ranges.map(e=>t.state.sliceDoc(e.from,e.to)),selectedText:t.state.selection.ranges.some(e=>!e.empty)});class Ke{constructor(e,l){this.timeLeftMS=void 0,this.timeoutMS=void 0,this.isCancelled=!1,this.isTimeExhausted=!1,this.callbacks=[],this.timeLeftMS=l,this.timeoutMS=l,this.callbacks.push(e)}tick(){if(!this.isCancelled&&!this.isTimeExhausted&&(this.timeLeftMS--,this.timeLeftMS<=0)){this.isTimeExhausted=!0;var e=this.callbacks.slice();this.callbacks.length=0,e.forEach(l=>{try{l()}catch(a){console.error("TimeoutLatch callback error:",a)}})}}cancel(){this.isCancelled=!0,this.callbacks.length=0}reset(){this.timeLeftMS=this.timeoutMS,this.isCancelled=!1,this.isTimeExhausted=!1}get isDone(){return this.isCancelled||this.isTimeExhausted}}class _{constructor(){this.interval=null,this.latches=new Set}add(e){this.latches.add(e),this.start()}remove(e){this.latches.delete(e),this.latches.size===0&&this.stop()}start(){this.interval===null&&(this.interval=setInterval(()=>{this.latches.forEach(e=>{e.tick(),e.isDone&&this.remove(e)})},1))}stop(){this.interval!==null&&(clearInterval(this.interval),this.interval=null)}}var U=null,Oe=()=>typeof window>"u"?new _:(U||(U=new _),U),V=Ce.define(),Be=200,He=[];function De(t){var{value:e,selection:l,onChange:a,onStatistics:i,onCreateEditor:d,onUpdate:f,extensions:o=He,autoFocus:r,theme:C="light",height:T=null,minHeight:S=null,maxHeight:L=null,width:M=null,minWidth:W=null,maxWidth:K=null,placeholder:O="",editable:B=!0,readOnly:H=!1,indentWithTab:D=!0,basicSetup:I=!0,root:z,initialState:E}=t,[b,N]=n.useState(),[s,u]=n.useState(),[v,y]=n.useState(),c=n.useState(()=>({current:null}))[0],m=n.useState(()=>({current:null}))[0],j=x.theme({"&":{height:T,minHeight:S,maxHeight:L,width:M,minWidth:W,maxWidth:K},"& .cm-scroller":{height:"100% !important"}}),R=x.updateListener.of(h=>{if(h.docChanged&&typeof a=="function"&&!h.transactions.some(G=>G.annotation(V))){c.current?c.current.reset():(c.current=new Ke(()=>{if(m.current){var G=m.current;m.current=null,G()}c.current=null},Be),Oe().add(c.current));var g=h.state.doc,p=g.toString();a(p,h)}i&&i(We(h))}),w=Me({theme:C,editable:B,readOnly:H,placeholder:O,indentWithTab:D,basicSetup:I}),k=[R,j,...w];return f&&typeof f=="function"&&k.push(x.updateListener.of(f)),k=k.concat(o),n.useLayoutEffect(()=>{if(b&&!v){var h={doc:e,selection:l,extensions:k},g=E?A.fromJSON(E.json,h,E.fields):A.create(h);if(y(g),!s){var p=new x({state:g,parent:b,root:z});u(p),d&&d(p,g)}}return()=>{s&&(y(void 0),u(void 0))}},[b,v]),n.useEffect(()=>{t.container&&N(t.container)},[t.container]),n.useEffect(()=>()=>{s&&(s.destroy(),u(void 0)),c.current&&(c.current.cancel(),c.current=null)},[s]),n.useEffect(()=>{r&&s&&s.focus()},[r,s]),n.useEffect(()=>{s&&s.dispatch({effects:Te.reconfigure.of(k)})},[C,o,T,S,L,M,W,K,O,B,H,D,I,a,f]),n.useEffect(()=>{if(e!==void 0){var h=s?s.state.doc.toString():"";if(s&&e!==h){var g=c.current&&!c.current.isDone,p=()=>{s&&e!==s.state.doc.toString()&&s.dispatch({changes:{from:0,to:s.state.doc.toString().length,insert:e||""},annotations:[V.of(!0)]})};g?m.current=p:p()}}},[e,s]),{state:v,setState:y,view:s,setView:u,container:b,setContainer:N}}var Ie=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],Ne=n.forwardRef((t,e)=>{var{className:l,value:a="",selection:i,extensions:d=[],onChange:f,onStatistics:o,onCreateEditor:r,onUpdate:C,autoFocus:T,theme:S="light",height:L,minHeight:M,maxHeight:W,width:K,minWidth:O,maxWidth:B,basicSetup:H,placeholder:D,indentWithTab:I,editable:z,readOnly:E,root:b,initialState:N}=t,s=q(t,Ie),u=n.useRef(null),{state:v,view:y,container:c,setContainer:m}=De({root:b,value:a,autoFocus:T,theme:S,height:L,minHeight:M,maxHeight:W,width:K,minWidth:O,maxWidth:B,basicSetup:H,placeholder:D,indentWithTab:I,editable:z,readOnly:E,selection:i,onChange:f,onStatistics:o,onCreateEditor:r,onUpdate:C,extensions:d,initialState:N});n.useImperativeHandle(e,()=>({editor:u.current,state:v,view:y}),[u,c,v,y]);var j=n.useCallback(w=>{u.current=w,m(w)},[m]);if(typeof a!="string")throw new Error("value must be typeof string but got "+typeof a);var R=typeof S=="string"?"cm-theme-"+S:"cm-theme";return Y.jsx("div",J({ref:j,className:""+R+(l?" "+l:"")},s))});Ne.displayName="CodeMirror";export{Ne as R};
